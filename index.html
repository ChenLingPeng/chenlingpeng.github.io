<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Developer in Tencent"><title>chenlingpeng | hahahaha</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">chenlingpeng</h1><a id="logo" href="/.">chenlingpeng</a><p class="description">hahahaha</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"><a href="/2020/01/19/ebpf-sockhash-debug/">ebpf/sockhash 内核bug定位分析</a></h1><div class="post-meta">2020-01-19</div><div class="post-content"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在尝试使用bpf来优化istio场景下本地sidecar和app之间的数据传输，使用了ebpf/sockhash的特性。简单来讲，如果一台机器上有两个进程的sock存在相互收发数据的情况，我们就可以利用ebpf/sockhash将一个socket需要发送的数据跳过本机的底层tcp/ip协议栈直接交给本机的目的socket，缩短数据在内核的处理路径。</p></div><p class="readmore"><a href="/2020/01/19/ebpf-sockhash-debug/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2020/01/08/linux-kernel-build-and-submit-patch/">linux 内核源码修改编译与patch提交</a></h1><div class="post-meta">2020-01-08</div><div class="post-content"><blockquote>
<p>最近在写bpf/sockmap的时候发现一个sockhash的内核bug，经过一系列定位后终于找到了问题代码并修复，最后将修复的patch提交到了社区。这是第一次向linux kernel提交代码，在这里记录一下~</p>
</blockquote>
<h1 id="linux内核编译"><a href="#linux内核编译" class="headerlink" title="linux内核编译"></a>linux内核编译</h1><p>首先需要准备一下编译环境</p></div><p class="readmore"><a href="/2020/01/08/linux-kernel-build-and-submit-patch/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2020/01/07/ebpf-intro/">ebpf intro</a></h1><div class="post-meta">2020-01-07</div><div class="post-content"><h1 id="eBPF简介"><a href="#eBPF简介" class="headerlink" title="eBPF简介"></a>eBPF简介</h1><p>eBPF(extended BPF)可以看作是可以高效且安全的在内核的一些hook point上执行用户代码的一个虚拟机，用户编写的代码被编译成字节码后加载到linux内核，内核内嵌了一个JIT将字节码转成native code后由事件触发形式执行BPF代码。eBPF由BPF发展而来，BPF全称Berkeley Packet Filter，当时主要是为了高效的过滤数据包而设计的，其历史可以追溯到1992年的论文<a href="http://www.tcpdump.org/papers/bpf-usenix93.pdf" target="_blank" rel="noopener">The BSD Packet Filter: A New Architecture for User-level Packet Capture</a>中。现在大家说到的BPF实际上是e(extended)BPF，相比于之前的BPF，eBPF是RISC指令集，有了更丰富的指令，11个64位的寄存器。开发者可以使用C语言写BPF程序，然后使用llvm+clang编译成bpf格式的obj file。然后通过bpf()系统调用加载在内核中hook point。下文中提到的BPF如果没有明确说明，都是指代eBPF。</p></div><p class="readmore"><a href="/2020/01/07/ebpf-intro/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2019/02/23/k8s-service-ip-problem/">k8s service ip problem</a></h1><div class="post-meta">2019-02-23</div><div class="post-content"><blockquote>
<p>最近在部署山东电力gaiastack环境，现场部署的小伙伴突然遇到紧急问题，发现在容器里面无法通过kubernetes这个service来访问kube-apiserver，导致我们的云盘无法提供正常服务。</p>
</blockquote>
<blockquote>
<p>gaiastack是什么？gaiastack是我们组开发的企业级kubernetes容器云管理平台，目前已在公司内外树立了一批标杆客户</p></blockquote></div><p class="readmore"><a href="/2019/02/23/k8s-service-ip-problem/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2018/05/04/k8s-floatingip-evolution/">k8s floatingip evolution</a></h1><div class="post-meta">2018-05-04</div><div class="post-content"><p>在我们内部的k8s系统的网络模式支持上，我们实现了多种网络模式的支持，最主要的就是overlay和floatingip的支持。<br>在k8s系统中实现floatingip网络模式的方案，最初我们采用了bridge+veth的模式，在跑容器的主机（物理机或虚拟机）上创建一个linux bridge，将原主机的网卡桥接到这个bridge。每创建一个pod，都创建一对veth设备，一端连接bridge，一端扔进容器里达到容器与外界2层可达的效果。实现模型如下图所示：</p></div><p class="readmore"><a href="/2018/05/04/k8s-floatingip-evolution/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2017/06/22/sriov-getting-start/">sriov getting start</a></h1><div class="post-meta">2017-06-22</div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在调研SR-IOV的使用，准备作为CNI插件用在kubernetes的Pod网络上。这篇文章是对SRIOV基础操作的介绍，通过介绍可以了解SRIOV的使用。</p></div><p class="readmore"><a href="/2017/06/22/sriov-getting-start/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2017/04/18/ipvs-attempt/">ipvs attempt</a></h1><div class="post-meta">2017-04-18</div><div class="post-content"><h1 id="前序"><a href="#前序" class="headerlink" title="前序"></a>前序</h1><p>k8s社区最近提了一个<a href="https://github.com/kubernetes/kubernetes/issues/44063" target="_blank" rel="noopener">issue</a>, 说的是huawei使用ipvs代替kube-proxy中的iptables模式作为service的负载均衡。根据我们组实际的情况，对ipvs整合k8s方案进行了一些尝试。</p></div><p class="readmore"><a href="/2017/04/18/ipvs-attempt/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2017/03/30/iptables-quick-start/">iptables quick start</a></h1><div class="post-meta">2017-03-30</div><div class="post-content"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>linux内置了一个强大的防火墙模块，称为iptables。用户通过在用户态操作iptables规则，可以使流量在内核态进行规则的匹配过滤。</p>
<p>Man手册中关于iptables的介绍为用于包过滤和NAT的系统工具。</p></div><p class="readmore"><a href="/2017/03/30/iptables-quick-start/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2017/03/16/calico-getting-start/">calico getting start</a></h1><div class="post-meta">2017-03-16</div><div class="post-content"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a href="https://www.projectcalico.org/" target="_blank" rel="noopener">Calico</a>是一个纯3层虚拟网络，可以为夸主机的容器/虚拟机等提供网络访问，同时支持IPv4和IPv6。并且可以根据策略提供访问控制能力。</p></div><p class="readmore"><a href="/2017/03/16/calico-getting-start/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="/2017/03/07/tcpdump-quick-start/">tcpdump quick start</a></h1><div class="post-meta">2017-03-07</div><div class="post-content"><p>tcpdump是linux上用于截获数据包的分析工具，提供了强大的包过滤和展示功能</p>
<p>tcpdump的用法主要是<code>tcpdump [option] [expression]</code></p>
<h2 id="option"><a href="#option" class="headerlink" title="option"></a>option</h2><p>-A<br>以ASCII码方式展示数据包，不显示链路层header信息</p></div><p class="readmore"><a href="/2017/03/07/tcpdump-quick-start/">阅读全文</a></p></div><nav class="page-navigator"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页</a></nav></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://chenlingpeng.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Distributed-System/">Distributed System</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lang/">lang</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/others/" style="font-size: 15px;">others</a> <a href="/tags/neural-network/" style="font-size: 15px;">neural network</a> <a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/Distributed-System/" style="font-size: 15px;">Distributed System</a> <a href="/tags/network/" style="font-size: 15px;">network</a> <a href="/tags/tcpdump/" style="font-size: 15px;">tcpdump</a> <a href="/tags/tc/" style="font-size: 15px;">tc</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/kubelet/" style="font-size: 15px;">kubelet</a> <a href="/tags/lang/" style="font-size: 15px;">lang</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/calico/" style="font-size: 15px;">calico</a> <a href="/tags/ebpf/" style="font-size: 15px;">ebpf</a> <a href="/tags/kernel/" style="font-size: 15px;">kernel</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/01/19/ebpf-sockhash-debug/">ebpf/sockhash 内核bug定位分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/08/linux-kernel-build-and-submit-patch/">linux 内核源码修改编译与patch提交</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/07/ebpf-intro/">ebpf intro</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/23/k8s-service-ip-problem/">k8s service ip problem</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/04/k8s-floatingip-evolution/">k8s floatingip evolution</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/22/sriov-getting-start/">sriov getting start</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/18/ipvs-attempt/">ipvs attempt</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/30/iptables-quick-start/">iptables quick start</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/16/calico-getting-start/">calico getting start</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/07/tcpdump-quick-start/">tcpdump quick start</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">chenlingpeng.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>